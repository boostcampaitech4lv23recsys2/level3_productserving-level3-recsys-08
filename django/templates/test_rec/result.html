{% extends 'test_rec/base.html' %}
{% load static %} 
{% block contents %}
<div class="result_wrap">
    <div class="container_result">
      <div class="nav_result">
        <div class="nav_result_box">
          <a href="#mbti" class="nav_result_li">나와 비슷한 캐릭터</a>
          <a href="#attractive" class="nav_result_li">매력적인 캐릭터</a>
        </div>
      </div>
      <div class="header_result">
        <div class="contents_header">
          <h3 class="contents_header_title">MVTI</h3>
          <h2 class="contents_header_subtitle">몇 개고? 내 닮은 캐릭터 말이다.</h2>
          <div class="container_header_bar"></div>
        </div>
        {% comment %} <img class="header_image" src="https://images.unsplash.com/photo-1478720568477-152d9b164e26?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80" alt="film" /> {% endcomment %}
      </div>
      <div class="background_wrap">
        <div class="contents_result">
            <div class="cards_box_container">
              <div class="cards_box">
                <div class="cards_category">
                  <div id="mbti" class="cards_category_text">나와 비슷한 캐릭터</div>
                </div>
                {% for character in data1 %}
                  <div id="data1" class="character_card" onclick="location.href='/test_rec/{{character.CharacterId}}'">
                    <img
                      src="{{ character.img_src }}"
                      class="card_image"
                      alt="Responsive image"
                    />
                    <div class="card_body">
                      <div class="card_title">{{ character.Character }}</div>
                      <div class="card_info" data-sim="{{character.Enneagram_sim}}">
                        <div class="card_info_items">
                          <div class="card_info_items_box">
                            <div class="card_info_item">
                              <span class="card_info_item_title">{{character.ko_title}}</span>
                            </div>
                            <div class="card_info_item">
                              <span class="card_info_item_title">MBTI | {{ character.MBTI }}</span>
                            </div>
                          </div>
                          <div class="card_info_item">
                            <span class="card_info_item_tag">{{ character.hashtag }}</span>
                          </div>
                        </div>
                        <div class="card_info_text_box">
                          <h6 class="card_info_text">유사도</h6>
                          <h6 class="card_info_text">{{character.Enneagram_sim}} %</h6>
                        </div>
                        <progress id="progress" value="{{character.Enneagram_sim}}" min="0" max="100"></progress>
                      </div>
                      
                    </div>
                  </div>
                {% endfor %}
                  
                <div class="cards_category category_color">
                  <div id="attractive" class="cards_category_text">나와 궁합이 잘맞는 캐릭터</div>
                </div>
                {% for character in data2 %}
                  <div id="data2" class="character_card" onclick="location.href='/test_rec/{{character.CharacterId}}'">
                    <img
                      src="{{ character.img_src }}"
                      class="card_image"
                      alt="Responsive image"
                    />
                    <div class="card_body">
                      <div class="card_title">{{ character.Character }}</div>
                      <div class="card_info" data-sim="{{character.Enneagram_sim}}">
                        <div class="card_info_items">
                          <div class="card_info_item">
                            <span class="card_info_item_title">{{character.ko_title}}</span>
                            
                          </div>
                          <div class="card_info_item">
                            <span class="card_info_item_title">MBTI | {{ character.MBTI }}</span>
                            
                          </div>
                          <div class="card_info_item">
                            <span class="card_info_item_tag">{{ character.hashtag }}</span>
                            
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>
            
        </div>
      </div>
    </div>
    
    <div class="button_group" style="width:auto; flex-wrap:wrap; margin:0 8vw; margin-top: 20px">
      <button class="retest_button" style="margin:0 1vw; margin-top:1vw">
        <a href="/test_rec/start_test" class="result_button">다시 테스트하기</a>
      </button>
      <div class="feedback_box" style="margin: 0 1vw; margin-top:1vw" data_user="{{tmpuser}}" data_loginUser="{{tmpuser.LoginUser_id}}">
        <button class="feedback" style="color:white;" value="+" id="thumbs_up">
          <i class="fa-regular fa-thumbs-up"></i>
          <span class="feedback_text" style="color:white;">추천결과가 맘에들어요</span>
        </button>
        <div class="divider"></div>
        <div class="feedback" value="-">
          <i class="fa-regular fa-thumbs-down"></i>
          <span class="feedback_text"></span>
        </div>
      </div>
      <button class="retest_button" style="margin: 0 1vw; margin-top:1vw">
        <a class="result_button" id="kakaotalk-sharing-btn" href="javascript:;" >카카오톡 공유하기</a>
      </button>
      <button class="retest_button" style="margin:0 1vw; margin-top:1vw" onclick="copyLink()">
        <a class="result_button" href="#">링크 공유하기</a>
      </button>
    </div>
    
    <a href="#"><div class="button_top" style="bottom: 115px"><i class="fa-solid fa-arrow-up"></i></div></a>
</div>

<div id="jsvariable" tmpuser_id="{{tmpuser.id}}"></div>
<script>
  $('.feedback').click(function(event){
    event.preventDefault();
    let userId = $('.feedback_box').attr('data_user')
    // let loginUserId = $('.like_box').attr('data_loginUser')
    
    let url = '/test_rec/feedback/' + userId
    let value = event.currentTarget.value
    console.log(value)
    $.ajax({
      type: 'POST',
      url: url,
      data: {
        'userId':userId,
        'value':value
      },
      success: function (response) {
        setTimeout(() => {
          console.log('response',response)
          if(response.feedback == 1){
           
            $('.feedback').append('<i class="fa-solid fa-thumbs-up"></i>')

          }else if(response.feedback == 0){
            $('.feedback').append('<i class="fa-solid fa-thumbs-down"></i>')
          }
        }, 500)
      },
      error: function (error) {
        setTimeout(() => {
          $('.wrap').innerHTML = `failed to load the data`
        }, 5000)
      }
    })
  })
</script>

<script>
  function copyLink() {
    const currentURL = window.location.href;
    navigator.clipboard.writeText(currentURL).then(function() {
      alert("링크 복사 완료!🥰");
    }, function(err) {
      console.error("링크 복사에 실패했습니다: ", err);
    });
  }
  </script>

{% endblock %}